{"version":3,"file":"_combobox-listbox-chunk.mjs","sources":["../../../../../darwin_arm64-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/listbox/listbox.ts","../../../../../darwin_arm64-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/listbox/option.ts","../../../../../darwin_arm64-fastbuild-ST-fdfa778d11ba/bin/src/aria/private/listbox/combobox-listbox.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {OptionPattern} from './option';\nimport {KeyboardEventManager, PointerEventManager, Modifier} from '../behaviors/event-manager';\nimport {computed, signal, SignalLike} from '../behaviors/signal-like/signal-like';\nimport {List, ListInputs} from '../behaviors/list/list';\n\n/** Represents the required inputs for a listbox. */\nexport type ListboxInputs<V> = ListInputs<OptionPattern<V>, V> & {\n  /** A unique identifier for the listbox. */\n  id: SignalLike<string>;\n\n  /** Whether the listbox is readonly. */\n  readonly: SignalLike<boolean>;\n};\n\n/** Controls the state of a listbox. */\nexport class ListboxPattern<V> {\n  listBehavior: List<OptionPattern<V>, V>;\n\n  /** Whether the list is vertically or horizontally oriented. */\n  orientation: SignalLike<'vertical' | 'horizontal'>;\n\n  /** Whether the listbox is disabled. */\n  disabled = computed(() => this.listBehavior.disabled());\n\n  /** Whether the listbox is readonly. */\n  readonly: SignalLike<boolean>;\n\n  /** The tab index of the listbox. */\n  tabIndex: SignalLike<-1 | 0> = computed(() => this.listBehavior.tabIndex());\n\n  /** The id of the current active item. */\n  activeDescendant = computed(() => this.listBehavior.activeDescendant());\n\n  /** Whether multiple items in the list can be selected at once. */\n  multi: SignalLike<boolean>;\n\n  /** The number of items in the listbox. */\n  setsize = computed(() => this.inputs.items().length);\n\n  /** Whether the listbox selection follows focus. */\n  followFocus = computed(() => this.inputs.selectionMode() === 'follow');\n\n  /** Whether the listbox should wrap. Used to disable wrapping while range selecting. */\n  wrap = signal(true);\n\n  /** The key used to navigate to the previous item in the list. */\n  prevKey = computed(() => {\n    if (this.inputs.orientation() === 'vertical') {\n      return 'ArrowUp';\n    }\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowRight' : 'ArrowLeft';\n  });\n\n  /** The key used to navigate to the next item in the list. */\n  nextKey = computed(() => {\n    if (this.inputs.orientation() === 'vertical') {\n      return 'ArrowDown';\n    }\n    return this.inputs.textDirection() === 'rtl' ? 'ArrowLeft' : 'ArrowRight';\n  });\n\n  /** Represents the space key. Does nothing when the user is actively using typeahead. */\n  dynamicSpaceKey = computed(() => (this.listBehavior.isTyping() ? '' : ' '));\n\n  /** The regexp used to decide if a key should trigger typeahead. */\n  typeaheadRegexp = /^.$/;\n\n  /** The keydown event manager for the listbox. */\n  keydown = computed(() => {\n    const manager = new KeyboardEventManager();\n\n    if (this.readonly()) {\n      return manager\n        .on(this.prevKey, () => this.listBehavior.prev())\n        .on(this.nextKey, () => this.listBehavior.next())\n        .on('Home', () => this.listBehavior.first())\n        .on('End', () => this.listBehavior.last())\n        .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key));\n    }\n\n    if (!this.followFocus()) {\n      manager\n        .on(this.prevKey, () => this.listBehavior.prev())\n        .on(this.nextKey, () => this.listBehavior.next())\n        .on('Home', () => this.listBehavior.first())\n        .on('End', () => this.listBehavior.last())\n        .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key));\n    }\n\n    if (this.followFocus()) {\n      manager\n        .on(this.prevKey, () => this.listBehavior.prev({selectOne: true}))\n        .on(this.nextKey, () => this.listBehavior.next({selectOne: true}))\n        .on('Home', () => this.listBehavior.first({selectOne: true}))\n        .on('End', () => this.listBehavior.last({selectOne: true}))\n        .on(this.typeaheadRegexp, e => this.listBehavior.search(e.key, {selectOne: true}));\n    }\n\n    if (this.inputs.multi()) {\n      manager\n        .on(Modifier.Any, 'Shift', () => this.listBehavior.anchor(this.listBehavior.activeIndex()))\n        .on(Modifier.Shift, this.prevKey, () => this.listBehavior.prev({selectRange: true}))\n        .on(Modifier.Shift, this.nextKey, () => this.listBehavior.next({selectRange: true}))\n        .on([Modifier.Ctrl | Modifier.Shift, Modifier.Meta | Modifier.Shift], 'Home', () =>\n          this.listBehavior.first({selectRange: true, anchor: false}),\n        )\n        .on([Modifier.Ctrl | Modifier.Shift, Modifier.Meta | Modifier.Shift], 'End', () =>\n          this.listBehavior.last({selectRange: true, anchor: false}),\n        )\n        .on(Modifier.Shift, 'Enter', () =>\n          this.listBehavior.updateSelection({selectRange: true, anchor: false}),\n        )\n        .on(Modifier.Shift, this.dynamicSpaceKey, () =>\n          this.listBehavior.updateSelection({selectRange: true, anchor: false}),\n        );\n    }\n\n    if (!this.followFocus() && this.inputs.multi()) {\n      manager\n        .on(this.dynamicSpaceKey, () => this.listBehavior.toggle())\n        .on('Enter', () => this.listBehavior.toggle())\n        .on([Modifier.Ctrl, Modifier.Meta], 'A', () => this.listBehavior.toggleAll());\n    }\n\n    if (!this.followFocus() && !this.inputs.multi()) {\n      manager.on(this.dynamicSpaceKey, () => this.listBehavior.toggleOne());\n      manager.on('Enter', () => this.listBehavior.toggleOne());\n    }\n\n    if (this.inputs.multi() && this.followFocus()) {\n      manager\n        .on([Modifier.Ctrl, Modifier.Meta], this.prevKey, () => this.listBehavior.prev())\n        .on([Modifier.Ctrl, Modifier.Meta], this.nextKey, () => this.listBehavior.next())\n        .on([Modifier.Ctrl, Modifier.Meta], ' ', () => this.listBehavior.toggle())\n        .on([Modifier.Ctrl, Modifier.Meta], 'Enter', () => this.listBehavior.toggle())\n        .on([Modifier.Ctrl, Modifier.Meta], 'Home', () => this.listBehavior.first())\n        .on([Modifier.Ctrl, Modifier.Meta], 'End', () => this.listBehavior.last())\n        .on([Modifier.Ctrl, Modifier.Meta], 'A', () => {\n          this.listBehavior.toggleAll();\n          this.listBehavior.select(); // Ensure the currect option remains selected.\n        });\n    }\n\n    return manager;\n  });\n\n  /** The pointerdown event manager for the listbox. */\n  pointerdown = computed(() => {\n    const manager = new PointerEventManager();\n\n    if (this.readonly()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!));\n    }\n\n    if (this.multi()) {\n      manager.on(Modifier.Shift, e =>\n        this.listBehavior.goto(this._getItem(e)!, {selectRange: true}),\n      );\n    }\n\n    if (!this.multi() && this.followFocus()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!, {selectOne: true}));\n    }\n\n    if (!this.multi() && !this.followFocus()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!, {toggle: true}));\n    }\n\n    if (this.multi() && this.followFocus()) {\n      return manager\n        .on(e => this.listBehavior.goto(this._getItem(e)!, {selectOne: true}))\n        .on(Modifier.Ctrl, e => this.listBehavior.goto(this._getItem(e)!, {toggle: true}));\n    }\n\n    if (this.multi() && !this.followFocus()) {\n      return manager.on(e => this.listBehavior.goto(this._getItem(e)!, {toggle: true}));\n    }\n\n    return manager;\n  });\n\n  constructor(readonly inputs: ListboxInputs<V>) {\n    this.readonly = inputs.readonly;\n    this.orientation = inputs.orientation;\n    this.multi = inputs.multi;\n    this.listBehavior = new List(inputs);\n  }\n\n  /** Returns a set of violations */\n  validate(): string[] {\n    const violations: string[] = [];\n\n    if (!this.inputs.multi() && this.inputs.values().length > 1) {\n      violations.push(\n        `A single-select listbox should not have multiple selected options. Selected options: ${this.inputs.values().join(', ')}`,\n      );\n    }\n\n    return violations;\n  }\n\n  /** Handles keydown events for the listbox. */\n  onKeydown(event: KeyboardEvent) {\n    if (!this.disabled()) {\n      this.keydown().handle(event);\n    }\n  }\n\n  onPointerdown(event: PointerEvent) {\n    if (!this.disabled()) {\n      this.pointerdown().handle(event);\n    }\n  }\n\n  /**\n   * Sets the listbox to it's default initial state.\n   *\n   * Sets the active index of the listbox to the first focusable selected\n   * item if one exists. Otherwise, sets focus to the first focusable item.\n   *\n   * This method should be called once the listbox and it's options are properly initialized,\n   * meaning the ListboxPattern and OptionPatterns should have references to each other before this\n   * is called.\n   */\n  setDefaultState() {\n    let firstItem: OptionPattern<V> | null = null;\n\n    for (const item of this.inputs.items()) {\n      if (this.listBehavior.isFocusable(item)) {\n        if (!firstItem) {\n          firstItem = item;\n        }\n        if (item.selected()) {\n          this.inputs.activeItem.set(item);\n          return;\n        }\n      }\n    }\n\n    if (firstItem) {\n      this.inputs.activeItem.set(firstItem);\n    }\n  }\n\n  protected _getItem(e: PointerEvent) {\n    if (!(e.target instanceof HTMLElement)) {\n      return;\n    }\n\n    const element = e.target.closest('[role=\"option\"]');\n    return this.inputs.items().find(i => i.element() === element);\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {computed, SignalLike} from '../behaviors/signal-like/signal-like';\nimport {List, ListInputs, ListItem} from '../behaviors/list/list';\n\n/**\n * Represents the properties exposed by a listbox that need to be accessed by an option.\n * This exists to avoid circular dependency errors between the listbox and option.\n */\ninterface ListboxPattern<V> {\n  inputs: ListInputs<OptionPattern<V>, V>;\n  listBehavior: List<OptionPattern<V>, V>;\n}\n\n/** Represents the required inputs for an option in a listbox. */\nexport interface OptionInputs<V> extends Omit<ListItem<V>, 'index' | 'selectable'> {\n  listbox: SignalLike<ListboxPattern<V> | undefined>;\n}\n\n/** Represents an option in a listbox. */\nexport class OptionPattern<V> {\n  /** A unique identifier for the option. */\n  id: SignalLike<string>;\n\n  /** The value of the option. */\n  value: SignalLike<V>;\n\n  /** The position of the option in the list. */\n  index = computed(() => this.listbox()?.inputs.items().indexOf(this) ?? -1);\n\n  /** Whether the option is active. */\n  active = computed(() => this.listbox()?.inputs.activeItem() === this);\n\n  /** Whether the option is selected. */\n  selected = computed(() => this.listbox()?.inputs.values().includes(this.value()));\n\n  /** Whether the option is selectable. */\n  selectable = () => true;\n\n  /** Whether the option is disabled. */\n  disabled: SignalLike<boolean>;\n\n  /** The text used by the typeahead search. */\n  searchTerm: SignalLike<string>;\n\n  /** A reference to the parent listbox. */\n  listbox: SignalLike<ListboxPattern<V> | undefined>;\n\n  /** The tab index of the option. */\n  tabIndex = computed(() => this.listbox()?.listBehavior.getItemTabindex(this));\n\n  /** The html element that should receive focus. */\n  element: SignalLike<HTMLElement | undefined>;\n\n  constructor(args: OptionInputs<V>) {\n    this.id = args.id;\n    this.value = args.value;\n    this.listbox = args.listbox;\n    this.element = args.element;\n    this.disabled = args.disabled;\n    this.searchTerm = args.searchTerm;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {ListboxInputs, ListboxPattern} from './listbox';\nimport {SignalLike, computed} from '../behaviors/signal-like/signal-like';\nimport {OptionPattern} from './option';\nimport {ComboboxPattern, ComboboxListboxControls} from '../combobox/combobox';\n\nexport type ComboboxListboxInputs<V> = ListboxInputs<V> & {\n  /** The combobox controlling the listbox. */\n  combobox: SignalLike<ComboboxPattern<OptionPattern<V>, V> | undefined>;\n};\n\nexport class ComboboxListboxPattern<V>\n  extends ListboxPattern<V>\n  implements ComboboxListboxControls<OptionPattern<V>, V>\n{\n  /** A unique identifier for the popup. */\n  id = computed(() => this.inputs.id());\n\n  /** The ARIA role for the listbox. */\n  role = computed(() => 'listbox' as const);\n\n  /** The id of the active (focused) item in the listbox. */\n  activeId = computed(() => this.listBehavior.activeDescendant());\n\n  /** The list of options in the listbox. */\n  items: SignalLike<OptionPattern<V>[]> = computed(() => this.inputs.items());\n\n  /** The tab index for the listbox. Always -1 because the combobox handles focus. */\n  override tabIndex: SignalLike<-1 | 0> = () => -1;\n\n  /** Whether multiple items in the list can be selected at once. */\n  override multi = computed(() => {\n    return this.inputs.combobox()?.readonly() ? this.inputs.multi() : false;\n  });\n\n  constructor(override readonly inputs: ComboboxListboxInputs<V>) {\n    if (inputs.combobox()) {\n      inputs.focusMode = () => 'activedescendant';\n      inputs.element = inputs.combobox()!.inputs.inputEl;\n    }\n\n    super(inputs);\n  }\n\n  /** Noop. The combobox handles keydown events. */\n  override onKeydown(_: KeyboardEvent): void {}\n\n  /** Noop. The combobox handles pointerdown events. */\n  override onPointerdown(_: PointerEvent): void {}\n\n  /** Noop. The combobox controls the open state. */\n  override setDefaultState(): void {}\n\n  /** Navigates to the specified item in the listbox. */\n  focus = (item: OptionPattern<V>, opts?: {focusElement?: boolean}) => {\n    this.listBehavior.goto(item, opts);\n  };\n\n  /** Navigates to the previous focusable item in the listbox. */\n  getActiveItem = () => this.inputs.activeItem();\n\n  /** Navigates to the next focusable item in the listbox. */\n  next = () => this.listBehavior.next();\n\n  /** Navigates to the previous focusable item in the listbox. */\n  prev = () => this.listBehavior.prev();\n\n  /** Navigates to the last focusable item in the listbox. */\n  last = () => this.listBehavior.last();\n\n  /** Navigates to the first focusable item in the listbox. */\n  first = () => this.listBehavior.first();\n\n  /** Unfocuses the currently focused item in the listbox. */\n  unfocus = () => this.listBehavior.unfocus();\n\n  /** Selects the specified item in the listbox. */\n  select = (item?: OptionPattern<V>) => this.listBehavior.select(item);\n\n  /** Toggles the selection state of the given item in the listbox. */\n  toggle = (item?: OptionPattern<V>) => this.listBehavior.toggle(item);\n\n  /** Clears the selection in the listbox. */\n  clearSelection = () => this.listBehavior.deselectAll();\n\n  /** Retrieves the OptionPattern associated with a pointer event. */\n  getItem = (e: PointerEvent) => this._getItem(e);\n\n  /** Retrieves the currently selected items in the listbox. */\n  getSelectedItems = () => {\n    // NOTE: We need to do this funky for loop to preserve the order of the selected values.\n    const items = [];\n    for (const value of this.inputs.values()) {\n      const item = this.items().find(i => i.value() === value);\n      if (item) {\n        items.push(item);\n      }\n    }\n    return items;\n  };\n\n  /** Sets the value of the combobox listbox. */\n  setValue = (value: V | undefined) => this.inputs.values.set(value ? [value] : []);\n}\n"],"names":["ListboxPattern","inputs","listBehavior","orientation","disabled","computed","readonly","tabIndex","activeDescendant","multi","setsize","items","length","followFocus","selectionMode","wrap","signal","prevKey","textDirection","nextKey","dynamicSpaceKey","isTyping","typeaheadRegexp","keydown","manager","KeyboardEventManager","on","prev","next","first","last","e","search","key","selectOne","Modifier","Any","anchor","activeIndex","Shift","selectRange","Ctrl","Meta","updateSelection","toggle","toggleAll","toggleOne","select","pointerdown","PointerEventManager","goto","_getItem","constructor","List","validate","violations","values","push","join","onKeydown","event","handle","onPointerdown","setDefaultState","firstItem","item","isFocusable","selected","activeItem","set","target","HTMLElement","element","closest","find","i","OptionPattern","id","value","index","listbox","indexOf","active","includes","selectable","searchTerm","getItemTabindex","args","ComboboxListboxPattern","role","activeId","combobox","focusMode","inputEl","_","focus","opts","getActiveItem","unfocus","clearSelection","deselectAll","getItem","getSelectedItems","setValue"],"mappings":"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"}